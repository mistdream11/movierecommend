doctype html
html
  head
    meta(charset='utf-8')
    meta(name='viewport', content='width=device-width, initial-scale=1')
    title 选择电影类型
    // 引入Inter字体（与整体风格统一）
    link(href='https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap', rel='stylesheet')
    style.
      /* ========== 全局CSS变量（蓝紫渐变风格） ========== */
      :root {
        /* 主色调 */
        --primary: #4361ee;
        --primary-light: #5874f5;
        --primary-dark: #3a56d4;
        --primary-gradient: linear-gradient(135deg, #4361ee 0%, #7b61ee 100%);

        /* 辅助色 */
        --secondary: #f8f9fa;
        --accent: #f1e85b;
        --text-main: #2d3748;
        --text-secondary: #718096;
        --text-white: #ffffff;
        --error-main: #e53e3e;
        --error-light: #fef7fb;
        --error-border: #feb2b2;

        /* 尺寸与圆角 */
        --radius-sm: 8px;
        --radius-md: 12px;
        --radius-lg: 16px;
        --shadow-light: rgba(67, 97, 238, 0.08);
        --shadow-medium: rgba(67, 97, 238, 0.12);
        --shadow-strong: rgba(67, 97, 238, 0.18);
      }

      /* 基础样式重置 */
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      }

      body {
        font-family: 'Inter', sans-serif; /* 替换为现代Inter字体 */
        background: linear-gradient(135deg, #e0f7fa 0%, #f3e5f5 100%); /* 蓝紫渐变背景 */
        margin: 0;
        padding: 40px 20px; /* 优化移动端内边距 */
        color: var(--text-main);
        min-height: 100vh;
        display: flex;
        align-items: center; /* 垂直居中 */
        justify-content: center;
      }

      .container {
        max-width: 960px;
        width: 100%;
        margin: 0 auto;
        background: var(--secondary);
        border-radius: var(--radius-lg); /* 大圆角 */
        box-shadow: 0 12px 32px var(--shadow-medium); /* 蓝紫风格阴影 */
        padding: 40px;
        transform: translateY(0);
      }

      .container:hover {
        transform: translateY(-3px);
        box-shadow: 0 16px 40px var(--shadow-strong); /* 悬浮阴影增强 */
      }

      h1 {
        margin-top: 0;
        font-size: 32px;
        font-weight: 700;
        /* 标题文字渐变 */
        background: var(--primary-gradient);
        -webkit-background-clip: text;
        background-clip: text;
        color: transparent;
        margin-bottom: 16px;
      }

      .intro {
        font-size: 16px;
        margin-bottom: 24px;
        color: var(--text-secondary);
        line-height: 1.6;
      }

      /* 错误提示框样式优化 */
      .error {
        color: var(--error-main);
        background: var(--error-light);
        border: 1px solid var(--error-border);
        padding: 12px 18px;
        border-radius: var(--radius-sm);
        margin-bottom: 24px;
        font-weight: 500;
        box-shadow: 0 4px 12px rgba(229, 62, 62, 0.08);
      }

      /* 类型网格布局优化 */
      .genre-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); /* 优化列宽 */
        gap: 12px;
        max-height: 360px;
        overflow-y: auto;
        padding: 20px;
        border: 1px solid rgba(67, 97, 238, 0.1); /* 淡蓝紫边框 */
        border-radius: var(--radius-md);
        background: #fff;
        margin-bottom: 8px;
        /* 滚动条美化 */
        scrollbar-width: thin;
        scrollbar-color: var(--primary-light) var(--secondary);
      }

      .genre-grid::-webkit-scrollbar {
        width: 6px;
      }

      .genre-grid::-webkit-scrollbar-track {
        background: var(--secondary);
        border-radius: 3px;
      }

      .genre-grid::-webkit-scrollbar-thumb {
        background: var(--primary-light);
        border-radius: 3px;
      }

      /* 类型选项样式 */
      .genre-item {
        display: flex;
        align-items: center;
        gap: 10px;
        padding: 12px 16px;
        border-radius: var(--radius-sm);
        cursor: pointer;
        border: 1px solid transparent;
      }

      .genre-item:hover {
        background: rgba(67, 97, 238, 0.05); /* 淡蓝紫hover背景 */
        border-color: rgba(67, 97, 238, 0.1);
        transform: translateX(2px);
      }

      /* 复选框样式美化 */
      .genre-item input[type="checkbox"] {
        width: 18px;
        height: 18px;
        accent-color: var(--primary); /* 复选框选中色适配主色 */
        cursor: pointer;
      }

      .genre-item span {
        font-size: 15px;
        font-weight: 500;
        color: var(--text-main);
      }

      .actions {
        margin-top: 30px;
        text-align: right;
      }

      /* 按钮样式 - 蓝紫渐变 */
      button {
        padding: 12px 32px;
        font-size: 16px;
        font-weight: 600;
        background: var(--primary-gradient); /* 渐变背景 */
        color: var(--text-white);
        border: none;
        border-radius: var(--radius-md); /* 中等圆角 */
        cursor: pointer;
        box-shadow: 0 4px 12px var(--shadow-light);
      }

      button:hover {
        background: linear-gradient(135deg, #3a56d4 0%, #6a51d4 100%); /* 深色渐变hover */
        transform: translateY(-2px);
        box-shadow: 0 6px 18px var(--shadow-medium);
      }

      button:active {
        transform: translateY(0);
        box-shadow: 0 2px 8px var(--shadow-light);
      }

      /* 空状态样式 */
      .genre-grid p {
        color: var(--text-secondary);
        text-align: center;
        padding: 20px;
        font-size: 15px;
      }

      /* 响应式适配 */
      @media (max-width: 768px) {
        .container {
          padding: 30px 20px;
        }
        h1 {
          font-size: 26px;
        }
        .genre-grid {
          grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
          padding: 15px;
        }
        button {
          width: 100%;
          padding: 12px 0;
        }
        .actions {
          text-align: center;
        }
      }

  body
    .container
      h1 你好 #{username}，请选择喜欢的电影类型
      p.intro 至少选择一个类型，我们将基于这些偏好为你挑选电影进行打分。
      if message
        p.error #{message}
      form(action='/selectgenres', method='post', onsubmit='return validateGenreSelection();')
        input(type='hidden', name='userid', value=userid)
        input(type='hidden', name='username', value=username)
        .genre-grid
          if genres && genres.length
            each genre in genres
              label.genre-item
                input(type='checkbox', name='genres', value=genre)
                span #{genre}
          else
            p 暂无可选类型，请联系管理员。
        .actions
          button(type='submit') 确认并继续
    script.
      function validateGenreSelection() {
        var checked = document.querySelectorAll('input[name="genres"]:checked');
        if (!checked.length) {
          alert('请至少选择一个类型标签');
          return false;
        }
        return true;
      }